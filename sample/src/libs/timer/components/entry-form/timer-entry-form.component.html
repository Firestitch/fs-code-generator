<div fxLayout="column">
  <mat-form-field class="mat-fullwidth">
    <mat-select [(ngModel)]="timeEntry.project_id" (ngModelChange)="onProjectChange()" placeholder="Project" fsFormRequired name="project_id">
      <mat-option *ngFor="let item of projects" [value]="item.id">
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
          <fs-badge shape="circle" image="{{ item?.image?.small }}"></fs-badge>
          <span>{{ item.name }}</span>
        </div>
      </mat-option>
    </mat-select>
  </mat-form-field>

  <ng-container *ngIf="timeEntry.project_id">

    <fs-autocomplete
      *ngIf="showAccount"
      [fetch]="fetchAccounts"
      [displayWith]="displayAccountWith"
      [(ngModel)]="selectedAccount"
      placeholder="Account"
      (ngModelChange)="onAccountChange($event)"
      [required]="true"
      name="account">
      <ng-template fsAutocompleteTemplate let-data="data">
        <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="start center">
          <app-account-image [account]="account"></app-account-image>
          <span>{{ data.first_name }} {{ data.last_name }}</span>
        </div>
      </ng-template>
    </fs-autocomplete>

    <fs-autocomplete
      [fetch]="fetchTasks"
      [displayWith]="displayTaskWith"
      [(ngModel)]="selectedTask"
      placeholder="Task"
      (ngModelChange)="onTaskChange($event)"
      name="task">
      <ng-template fsAutocompleteSuffix let-data="data">
        <mat-icon
          *ngIf="data && data.id"
          matSuffix
          color="primary"
          (click)="onProceedTask(data)">launch
        </mat-icon>
      </ng-template>
      <ng-template fsAutocompleteTemplate let-data="data">
        <div fxLayout="row" fxLayoutGap="4px">
          <app-object-identifier [object]="data" [project]="data.project"></app-object-identifier>
          <span>{{ data.name }}</span>
        </div>
      </ng-template>
    </fs-autocomplete>

    <mat-form-field class="mat-fullwidth">
      <textarea
        matInput
        [fsFormRequired]="mode === 'manual'"
        [(ngModel)]="timeEntry.description"
        (ngModelChange)="onDescriptionChange()"
        [matTextareaAutosize]="true"
        placeholder="Description"
        name="description">
      </textarea>
    </mat-form-field>

    <fs-radio-group *ngIf="showType" [ngModel]="mode" (ngModelChange)="onModeChange($event)" label="Type" name="mode">
      <mat-radio-button value="timer">Timer</mat-radio-button>
      <mat-radio-button value="manual">Manual</mat-radio-button>
    </fs-radio-group>

    <div *ngIf="mode === 'manual'" fxLayout="row" fxLayoutGap="5px">
      <mat-form-field fxFlex>
        <input
          matInput
          fsDatePicker
          [ngModel]="startDate"
          (ngModelChange)="onStartDateChange($event)"
          fsFormRequired
          view="datetime"
          name="start_date"
          placeholder="Date">
      </mat-form-field>

      <!--
        inputUnit should be minutes. In DB we store duration as integer amount of minutes.
        By default component handle it as hours value.
      -->
      <mat-form-field fxFlex>
        <input
          matInput
          name="duration"
          placeholder="Duration"
          [ngModel]="minutes"
          inputUnit="minutes"
          (ngModelChange)="onMinutesChange($event)"
          fsFormRequired
          fsDuration>
      </mat-form-field>
    </div>

    <!-- Block available only on manual timer change -->
    <div *ngIf="showType && mode === 'timer'" fxLayout="row" fxLayoutGap="5px">
        <mat-form-field fxFlex>
          <input
            matInput
            fsDatePicker
            [(ngModel)]="timeEntry.start_date"
            (ngModelChange)="onDatesChange()"
            fsFormRequired
            view="datetime"
            name="start_date"
            placeholder="Start">
            <mat-hint *ngIf="timerDuration">Duration: {{ timerDuration | fsDateDuration: { hours: true, minutes: true } }}</mat-hint>
        </mat-form-field>
  
        <mat-form-field fxFlex>
          <input
            matInput
            fsDatePicker
            [(ngModel)]="timeEntry.end_date"
            (ngModelChange)="onDatesChange()"
            fsFormRequired
            view="datetime"
            name="end_date"
            placeholder="End">
        </mat-form-field>
      </div>
  </ng-container>
</div>
