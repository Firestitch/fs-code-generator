<ng-container *ngIf="!loading">
  <div [fsDrawerSide]="drawer">
    <ng-template fsDrawerAction="related">
      <app-related-objects
        [sourceObject]="doc"
        (highlightSwitch)="getRelatedObjects()"
        (remove)="getRelatedObjects()"
        (relatesChange)="getRelatedObjects()">
      </app-related-objects>
    </ng-template>

    <ng-template fsDrawerAction="versions">
      <app-object-versions [object]="doc" (versionChanged)="updateDoc($event)"></app-object-versions>
    </ng-template>

    <ng-template fsDrawerAction="info">
      <app-doc-info [doc]="doc" (typeChanged)="changeType($event)"></app-doc-info>
    </ng-template>
  </div>

  <div fsDrawerContent class="doc-drawer-container">
    <div class="container" *ngIf="doc">
      <div class="doc-header" fxLayout="row" fxLayoutAlign="stretch center" fxLayoutGap="10px">
        <app-type-menu fxFlex="nogrow" [type]="doc.type" class="doc" (typeChanged)="changeType($event)"></app-type-menu>

        <div fxFlex="noshrink">
          <app-object-identifier [object]="doc" [project]="doc.project"></app-object-identifier>
        </div>

        <!-- FS-T1067: Added form tag for validation -->
        <!-- Added (fsForm) because without it validation message fires error and doesn't work -->
        <form (fsForm)="onNameChange()" fxFlex="grow">
          <mat-form-field fxFlex="grow" class="name">
            <input matInput [(ngModel)]="doc.name" name="name" (blur)="onNameChange()" fsFormRequired>
          </mat-form-field>
        </form>

        <app-status-menu fxFlex="nogrow" class="doc" [status]="doc.status" label="" (statusChanged)="changeStatus($event)"></app-status-menu>
      </div>

      <div class="doc-content" fxLayout="column">

        <fs-attribute-field
            class="tag"
            [data]="{ project_id: doc.project_id, object_id: doc.id }"
            (changed)="tagsChanged($event)">
        </fs-attribute-field>

        <form (fsForm)="saveNewVersion()">
          <div *ngIf="doc.id" fxLayout="column">
            <div class="fields">
              <fs-field-renderer [config]="config" *ngIf="config.fields"></fs-field-renderer>
            </div>

            <app-highlighted-related-view [objects]="relatedObjects"></app-highlighted-related-view>

            <div fxFlex>
              <button mat-raised-button color="primary" type="submit">Save</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</ng-container>
